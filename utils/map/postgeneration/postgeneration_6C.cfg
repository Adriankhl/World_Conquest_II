## Industrial

#define WORLD_CONQUEST_TEK_MAP_POSTGENERATION_6C
{WORLD_CONQUEST_TEK_MAP_REPAINT_6C_UTILITY_EVENTS}
[event]
    name=prestart
    {WORLD_CONQUEST_TEK_ENEMY_ARMY_EVENT}
    {WORLD_CONQUEST_TEK_MAP_REPAINT_6C}
    {CLEAR_VARIABLE terrain_to_change}
[/event]
#enddef

#define WORLD_CONQUEST_TEK_MAP_REPAINT_6C_UTILITY_EVENTS
{WCT_ROADS_TO_RIVER_INDUSTRY_EVENTS}
{WCT_ROADS_TO_FACTORY_EVENTS}
{WCT_ROADS_TO_INDUSTRIAL_CITY_EVENTS}
{WCT_ROADS_TO_INDUSTRIAL_VILLAGE_EVENTS}
{WCT_RAILS_TO_INDUSTRIAL_KEEP_EVENTS}
#enddef

#define WORLD_CONQUEST_TEK_MAP_REPAINT_6C
## soft hills clusters
[store_locations]
    terrain=Hh,Hh^F*,Hh^Uf
    [filter_adjacent_location]
        terrain=H*^*,M*^*,C*,K*
        count=6
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 2 Gs,Gs,Gg,Gs,Gs,Gg,Gs,Gs,Gg,Gs,Gs,Gg,Hh^Fp}
[store_locations]
    terrain=Ha,Ha^F*
    [filter_adjacent_location]
        terrain=H*^*,M*^*,C*,K*
        count=6
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 2 Gs,Aa^Fma,Wwf,Aa,Aa}

{WORLD_CONQUEST_TEK_MAP_DECORATION_6C}

{WCT_REDUCE_WALL_CLUSTERS (Uu,Uu^Uf,Uh,Uu^Uf,Uu,Uu^Uf,Uh,Ql,Qxu,Xu,Uu,Rb)}
{WCT_FILL_LAVA_CHASMS}
{WCT_VOLCANOS}
{WCT_VOLCANOS_DIRT}
## volcanos dry mountains
[terrain]
    terrain=Md
    layer=base
    [and]
        terrain=Mm^*
        [and]
            terrain=Mv
            radius=2
        [/and]
    [/and]
[/terrain]
## lava dry mountains
[terrain]
    terrain=Md
    layer=base
    [and]
        terrain=Mm*^*
        [and]
            terrain=Ql
            radius=1
        [/and]
    [/and]
[/terrain]
{CLEAR_VARIABLE terrain_to_change,rand,random}
## decoration fix to first intended
[terrain]
    terrain=Rb
    layer=base
    [and]
        terrain=Urb^*
    [/and]
[/terrain]
#enddef

#define WORLD_CONQUEST_TEK_MAP_DECORATION_6C
## clean river into ocean
[terrain]
    terrain=Wwt
    [and]
        terrain=Ww
    [/and]
    [filter_adjacent_location]
        terrain=Wwt^*
    [/filter_adjacent_location]
    [filter_adjacent_location]
        terrain=G*^*,D*^*,H*^*,C*,K*
        count=0
    [/filter_adjacent_location]
[/terrain]
[terrain]
    terrain=Wot
    [and]
        terrain=Ww
    [/and]
    [filter_adjacent_location]
        terrain=Wwt^*,Wot
    [/filter_adjacent_location]
    [filter_adjacent_location]
        terrain=G*^*,D*^*,H*^*,C*,K*
        count=0
    [/filter_adjacent_location]
[/terrain]
[terrain]
    terrain=Wot
    [and]
        terrain=Ww
    [/and]
    [not]
        terrain=C*,K*,*^V*
        radius=50
        [filter_radius]
            terrain=Ww^*
        [/filter_radius]
    [/not]
[/terrain]
## industrial villages near river and road
[terrain]
    terrain=Hhd^Vud
    [and]
        terrain=H*^V*
        [filter_adjacent_location]
            terrain=Urb,Ww
        [/filter_adjacent_location]
    [/and]
[/terrain]
[terrain]
    terrain=Urb^Vud
    [and]
        terrain=G*^V*,D*^V*
        [filter_adjacent_location]
            terrain=Urb^*
        [/filter_adjacent_location]
    [/and]
[/terrain]
[terrain]
    terrain=Gs^Vud
    [and]
        terrain=G*^V*,D*^V*
        [filter_adjacent_location]
            terrain=Ww
        [/filter_adjacent_location]
    [/and]
[/terrain]
## expand infrastructure of industrial villages near river
{WCT_INDUSTRY_BRIDGE \ nw,se}
{WCT_INDUSTRY_BRIDGE / ne,sw}
{WCT_INDUSTRY_BRIDGE | n,s}
{WCT_ITERATE_ROADS_TO river_industry 3}
[terrain]
    terrain=Urb
    [and]
        terrain=Re,Rp
    [/and]
[/terrain]
[terrain]
    terrain=*^Bcx\
    layer=overlay
    [and]
        terrain=*^Bw\
    [/and]
[/terrain]
[terrain]
    terrain=*^Bcx/
    layer=overlay
    [and]
        terrain=*^Bw/
    [/and]
[/terrain]
[terrain]
    terrain=*^Bcx|
    layer=overlay
    [and]
        terrain=*^Bw|
    [/and]
[/terrain]
{WCT_ITERATE_ROADS_TO river_industry 4}
[terrain]
    terrain=Urb
    layer=base
    [and]
        terrain=Rr,Rp,Re,Gs^Vud
    [/and]
[/terrain]
## expand infrastructure to factories
[terrain]
    terrain=*^Vhh
    layer=overlay
    [and]
        terrain=*^Vh
    [/and]
    [and]
        terrain=C*,K*,Urb^*
        radius=5
        [filter_radius]
            terrain=!,W*^*
        [/filter_radius]
    [/and]
[/terrain]
{WCT_ITERATE_ROADS_TO factory 4}
[terrain]
    terrain=Rr^Vhh
    [and]
        terrain=G*^Vhh
    [/and]
[/terrain]
[terrain]
    terrain=Hhd^Vhh
    [and]
        terrain=H*^Vhh
    [/and]
[/terrain]
## expand infrastructure to cities
[terrain]
    terrain=*^Vhc
    layer=overlay
    [and]
        terrain=*^Vh
    [/and]
    [and]
        terrain=C*,K*,Urb^*,Rr^*
        radius=6
        [filter_radius]
            terrain=!,W*^*
        [/filter_radius]
    [/and]
[/terrain]
[terrain]
    terrain=Rrc^Vhc
    [and]
        terrain=G*^Vhc
    [/and]
[/terrain]
{WCT_ITERATE_ROADS_TO industrial_city 5}
## sawmills
[terrain]
    terrain=*^Vl
    layer=overlay
    [and]
        terrain=*^Vh
    [/and]
    [filter_adjacent_location]
        terrain=*^F*
    [/filter_adjacent_location]
[/terrain]
[terrain]
    terrain=Rb^Vl
    [and]
        terrain=G*^Vl
    [/and]
[/terrain]
## villages
[terrain]
    terrain=*^Ve
    layer=overlay
    [and]
        terrain=*^Vh
    [/and]
    [and]
        terrain=C*,K*,Urb^*,Rr*^*
        radius=4
        [filter_radius]
            terrain=!,W*^*
        [/filter_radius]
    [/and]
[/terrain]
[terrain]
    terrain=Rb^Ve
    [and]
        terrain=G*^Ve
    [/and]
[/terrain]
## expand infrastructure to villages and sawmills
{WCT_ITERATE_ROADS_TO industrial_village 3}
## castle rails
[terrain]
    terrain=Rr^Br|
    [and]
        terrain=Rr
    [/and]
    [and]
        terrain=K*
        radius=8
        [filter_radius]
            terrain=Rr,C*,K*
        [/filter_radius]
    [/and]
[/terrain]
{WCT_ITERATE_ROADS_TO industrial_keep 3}
[terrain]
    terrain=Rr^Br\
    layer=overlay
    [and]
        terrain=*^Br|
    [/and]
    [filter_adjacent_location]
        terrain=*^Vhh
        count=1-2
        adjacent=nw,se
    [/filter_adjacent_location]
[/terrain]
[terrain]
    terrain=Rr^Br/
    layer=overlay
    [and]
        terrain=*^Br|
    [/and]
    [filter_adjacent_location]
        terrain=*^Vhh
        count=1-2
        adjacent=ne,sw
    [/filter_adjacent_location]
[/terrain]
{WCT_CONECT_FACTORY_RAILS}
## muddy rivers
[terrain]
    terrain=Sm
    layer=base
    [and]
        terrain=Ww^*
        [and]
            terrain=Wwt,Wot
            radius=2
            [filter_radius]
                terrain=Ww^*,C*,K*
            [/filter_radius]
        [/and]
    [/and]
[/terrain]
[store_locations]
    terrain=Sm^*
    [filter_adjacent_location]
        terrain=Ww^*
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{FOREACH terrain_to_change swamp_i}
    {RANDOM 3..19}
    [terrain]
        terrain=Sm
        layer=base
        [and]
            terrain=Ww^*
            [and]
                x=$terrain_to_change[$swamp_i].x
                y=$terrain_to_change[$swamp_i].y
                radius=$random
                [filter_radius]
                    terrain=Ww^*,C*,K*
                [/filter_radius]
            [/and]
        [/and]
    [/terrain]
{NEXT swamp_i}
## dirty rivers
[store_locations]
    terrain=Sm^*
    [filter_adjacent_location]
        terrain=Ww^*
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{FOREACH terrain_to_change water_i}
    {RANDOM 4..13}
    [terrain]
        terrain=Wwg
        layer=base
        [and]
            terrain=Ww^*
            [and]
                x=$terrain_to_change[$water_i].x
                y=$terrain_to_change[$water_i].y
                radius=$random
                [filter_radius]
                    terrain=Ww^*,C*,K*
                [/filter_radius]
            [/and]
        [/and]
    [/terrain]
{NEXT water_i}
## fords
{RANDOM 4..10}
[terrain]
    terrain=Wwf
    layer=base
    [and]
        terrain=Ww^*
        [not]
            terrain=Wwg^*
            radius=$random
            [filter_radius]
                terrain=Ww^*,C*,K*
            [/filter_radius]
        [/not]
    [/and]
[/terrain]
## narrow rivers
{WCT_FORD_DELTAS}
{WCT_DIRTY_DELTAS}
## detritus on sand
[store_locations]
    terrain=Dd,Ds
    [filter_adjacent_location]
        terrain=Sm,*^Vud
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{RANDOM 1..2}
{WCT_FRACTION_LAYER_REPLACE $random *^Edt overlay}
## reefs
[store_locations]
    terrain=Wot,Wwt
    [filter_adjacent_location]
        terrain=Wwt,G*^*,M*^*,H*^*
    [/filter_adjacent_location]
    [not]
        terrain=Sm
        radius=4
    [/not]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 15 Wwr}
## beachs sand and stones
[store_locations]
    terrain=Ds
    [filter_adjacent_location]
        terrain=Wwt,Wot
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{RANDOM 9..11}
{WCT_FRACTION_REPLACE $random Ds^Esd}
## fix ocean water type
[terrain]
    terrain=Rd
    [and]
        terrain=Wwt,Wot
    [/and]
    [filter_adjacent_location]
        terrain=Sm
    [/filter_adjacent_location]
[/terrain]
[terrain]
    terrain=Ww
    layer=base
    [and]
        terrain=Wwt^*
    [/and]
[/terrain]
[terrain]
    terrain=Wo
    [and]
        terrain=Wot
    [/and]
[/terrain]
[terrain]
    terrain=Wwg
    [and]
        terrain=Sm
        [not]
            terrain=*^V*,C*,K*
            radius=999
            [filter_radius]
                terrain=Sm^*,Wwg
            [/filter_radius]
        [/not]
    [/and]
[/terrain]
[terrain]
    terrain=Wwg
    [and]
        terrain=Rd
    [/and]
[/terrain]
## castle kinds
[terrain]
    terrain=Cud
    layer=base
    [and]
        terrain=Ch^*
        [and]
            terrain=K*^*,Sm,Wwg
            radius=5
            [filter_radius]
                terrain=C*^*,Sm,Wwg,K*^*
            [/filter_radius]
        [/and]
    [/and]
[/terrain]
[terrain]
    terrain=Chw
    [and]
        terrain=Ch
    [/and]
[/terrain]
## industry damages landscape
[store_locations]
    terrain=G*^*
    [filter_adjacent_location]
        terrain=Urb,*^Vud
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_LAYER_REPLACE 1 Re,Gd base}
[store_locations]
    terrain=G*
    [filter_adjacent_location]
        terrain=*^Vl
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_LAYER_REPLACE 1 Re,Gd,Gs base}
[store_locations]
    terrain=G*^*
    [filter_adjacent_location]
        terrain=Rr^*,*^Vhh,Cud^*,Ch^*
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_LAYER_REPLACE 2 Gs,Gs,Gs,Gd base}
[terrain]
    terrain=Gd
    layer=base
    [and]
        terrain=G*^*
    [/and]
    [filter_adjacent_location]
        terrain=Re
    [/filter_adjacent_location]
[/terrain]
[terrain]
    terrain=Gs
    layer=base
    [and]
        terrain=Gg*^*
    [/and]
    [filter_adjacent_location]
        terrain=Gd*^*
    [/filter_adjacent_location]
[/terrain]
[store_locations]
    terrain=Hh^*
    [filter_adjacent_location]
        terrain=Urb,*^Vud
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_LAYER_REPLACE 2 Hhd,Hhd,Hhd,Hhd,Hhd^Dr base}
[store_locations]
    terrain=Hh
    [and]
        terrain=*^Vud
        radius=2
    [/and]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 2 Gd^Dr,Hhd^Edt,Hhd^Edt,Hhd^Edt,Hhd^Dr}
## rough extra terrain noise
[store_locations]
    terrain=G*
    [filter_adjacent_location]
        terrain=Sm^*,C*^*,K*,W*^*,*^V*,Ds
        count=0
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 15 Gs^Fp,Gs^Fp,Gs^Fp,Gs^Fp,Gs^Fp,Gs^Fmw,Hh^Fp,Hh,Hh,Mm,Mm,Gs^Uf}
[store_locations]
    terrain=G*
    [filter_adjacent_location]
        terrain=Sm^*,C*^*,K*,W*^*,*^V*,Ds
        count=0
    [/filter_adjacent_location]
    [and]
        terrain=Urb
        radius=2
    [/and]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 20 Ch}
[store_locations]
    terrain=Hh
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 24 Hh^Fp,Hh^Fp,Hh^Fp,Hh^Fp,Hh^Fmw}
[store_locations]
    terrain=Dd
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 10 Hd}
## cave path
[store_locations]
    terrain=Uh,Uu
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_REPLACE 20 Rb}
## difumine dry border
[store_locations]
    terrain=Gd^*
    [filter_adjacent_location]
        terrain=Gs^*
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_LAYER_REPLACE 11 Gs base}
[terrain]
    terrain=*^Fdw
    layer=overlay
    [and]
        terrain=Gd^Fet,Re^Fet
    [/and]
[/terrain]
#enddef

#define WCT_INDUSTRY_BRIDGE BRIDGE DIRECTIONS
[terrain]
    terrain=*^Bw{BRIDGE}
    layer=overlay
    [and]
        terrain=Ww,
        [filter_adjacent_location]
            terrain=*^Vud
            count=1
            adjacent={DIRECTIONS}
        [/filter_adjacent_location]
        [filter_adjacent_location]
            terrain=Urb,G*,C*,K*,A*
            count=1
            adjacent={DIRECTIONS}
        [/filter_adjacent_location]
    [/and]
[/terrain]
[terrain]
    terrain=Rr
    [and]
        terrain=G*,A*
        [filter_adjacent_location]
            terrain=*^Bw{BRIDGE}
            count=1-2
            adjacent={DIRECTIONS}
        [/filter_adjacent_location]
    [/and]
[/terrain]
#enddef

#define WCT_ROADS_TO_RIVER_INDUSTRY_EVENTS
[event]
    name=wct_store_roads_river_industry
    first_time_only=no
    [store_locations]
        terrain=!,W*^*,*^V*,*^Bcx*,Urb,C*,K*,R*
        [filter_adjacent_location]
            terrain=*^Vud,Re,Rr
            [not]
                terrain=K*
                radius=999
                [filter_radius]
                    terrain=Urb^*,*^Bcx*,C*,K*,*^V*,R*
                [/filter_radius]
            [/not]
            [not]
                terrain=C*,K*,Urb^*
                radius=$radius
                [filter_radius]
                    terrain=!,W*^*
                [/filter_radius]
            [/not]
            [filter_adjacent_location]
                terrain=Re,Rr
                [and]
                    terrain=C*,K*,Urb^*
                    radius=$radius
                    [filter_radius]
                        terrain=!,W*^*
                    [/filter_radius]
                [/and]
                count=0
            [/filter_adjacent_location]
        [/filter_adjacent_location]
        [and]
            terrain=C*,K*,Urb^*
            radius=$radius
            [filter_radius]
                terrain=!,W*^*
            [/filter_radius]
        [/and]
        variable=terrain_to_change
    [/store_locations]
[/event]
{WCT_CREATE_EVENT_ROADS_TO river_industry Re}
#enddef

#define WCT_ROADS_TO_FACTORY_EVENTS
[event]
    name=wct_store_roads_factory
    first_time_only=no
    [store_locations]
        terrain=!,W*^*,*^V*,*^Bcx*,Urb,C*,K*,R*
        [filter_adjacent_location]
            terrain=*^Vhh,Rr
            [not]
                terrain=C*,K*,Urb^*
                radius=$radius
                [filter_radius]
                    terrain=!,W*^*
                [/filter_radius]
            [/not]
            [filter_adjacent_location]
                terrain=Rr
                [and]
                    terrain=C*,K*,Urb^*
                    radius=$radius
                    [filter_radius]
                        terrain=!,W*^*
                    [/filter_radius]
                [/and]
                count=0
            [/filter_adjacent_location]
        [/filter_adjacent_location]
        [and]
            terrain=C*,K*,Urb^*
            radius=$radius
            [filter_radius]
                terrain=!,W*^*
            [/filter_radius]
        [/and]
        variable=terrain_to_change
    [/store_locations]
[/event]
{WCT_CREATE_EVENT_ROADS_TO factory Rr}
#enddef

#define WCT_ROADS_TO_INDUSTRIAL_CITY_EVENTS
[event]
    name=wct_store_roads_industrial_city
    first_time_only=no
    [store_locations]
        terrain=!,W*^*,*^V*,*^Bcx*,Urb,C*,K*,R*
        [filter_adjacent_location]
            terrain=*^Vhc,Rrc
            [not]
                terrain=C*,K*,Urb^*,Rr^*,*^Vhh
                radius=$radius
                [filter_radius]
                    terrain=!,W*^*
                [/filter_radius]
            [/not]
            [filter_adjacent_location]
                terrain=Rrc
                [and]
                    terrain=C*,K*,Urb^*,Rr^*,*^Vhh
                    radius=$radius
                    [filter_radius]
                        terrain=!,W*^*
                    [/filter_radius]
                [/and]
                count=0
            [/filter_adjacent_location]
        [/filter_adjacent_location]
        [and]
            terrain=C*,K*,Urb^*,Rr^*,*^Vhh
            radius=$radius
            [filter_radius]
                terrain=!,W*^*
            [/filter_radius]
        [/and]
        variable=terrain_to_change
    [/store_locations]
[/event]
{WCT_CREATE_EVENT_ROADS_TO industrial_city Rrc}
#enddef

#define WCT_ROADS_TO_INDUSTRIAL_VILLAGE_EVENTS
[event]
    name=wct_store_roads_industrial_village
    first_time_only=no
    [store_locations]
        terrain=!,W*^*,*^V*,*^Bcx*,Urb,C*,K*,R*
        [filter_adjacent_location]
            terrain=*^Ve,*^Vl,Rb
            [not]
                terrain=C*,K*,Urb^*,Rr*^*,*^Vhh,*^Vhc
                radius=$radius
                [filter_radius]
                    terrain=!,W*^*
                [/filter_radius]
            [/not]
            [filter_adjacent_location]
                terrain=Rb
                [and]
                    terrain=C*,K*,Urb^*,Rr*^*,*^Vhh,*^Vhc
                    radius=$radius
                    [filter_radius]
                        terrain=!,W*^*
                    [/filter_radius]
                [/and]
                count=0
            [/filter_adjacent_location]
        [/filter_adjacent_location]
        [and]
            terrain=C*,K*,Urb^*,Rr*^*,*^Vhh,*^Vhc
            radius=$radius
            [filter_radius]
                terrain=!,W*^*
            [/filter_radius]
        [/and]
        variable=terrain_to_change
    [/store_locations]
[/event]
{WCT_CREATE_EVENT_ROADS_TO industrial_village Rb}
#enddef

#define WCT_RAILS_TO_INDUSTRIAL_KEEP_EVENTS
[event]
    name=wct_store_roads_industrial_keep
    first_time_only=no
    [store_locations]
        terrain=C*
        [filter_adjacent_location]
            terrain=*^Br*,*^Vhh
            [not]
                terrain=K*
                radius=$radius
                [filter_radius]
                    terrain=C*,*^Br*,*^Vhh
                [/filter_radius]
            [/not]
            [filter_adjacent_location]
                terrain=*^Br*,*^Vhh
                [and]
                    terrain=K*
                    radius=$radius
                    [filter_radius]
                        terrain=C*,*^Br*,*^Vhh
                    [/filter_radius]
                [/and]
                count=0
            [/filter_adjacent_location]
        [/filter_adjacent_location]
        [and]
            terrain=K*
            radius=$radius
            [filter_radius]
                terrain=C*,*^Br*,*^Vhh
            [/filter_radius]
        [/and]
        variable=terrain_to_change
    [/store_locations]
[/event]
{WCT_CREATE_EVENT_ROADS_TO industrial_keep Cud^Br|}
#enddef

#define WCT_STORE_POSSIBLE_FORD_DELTA
[store_locations]
    terrain=Wwf
    [filter_adjacent_location]
        terrain=W*^*
        count=5-6
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
#enddef

#define WCT_FORD_DELTAS
{WCT_STORE_POSSIBLE_FORD_DELTA}
[while]
    [variable]
        name=terrain_to_change.length
        greater_than=0
    [/variable]
[do]
    {RANDOM Gg,Gg^Efm,Mm,Gg^Fet,Gg,Mm,Gg}
    [terrain]
        terrain=$random
        x,y=$terrain_to_change.x,$terrain_to_change.y
    [/terrain]
    {WCT_STORE_POSSIBLE_FORD_DELTA}
[/do]
[/while]
#enddef

#define WCT_STORE_POSSIBLE_DIRTY_DELTA
[store_locations]
    terrain=Wwg,Sm
    [filter_adjacent_location]
        terrain=Wwg^*,Sm^*
        count=5-6
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
#enddef

#define WCT_DIRTY_DELTAS
{WCT_STORE_POSSIBLE_DIRTY_DELTA}
[while]
    [variable]
        name=terrain_to_change.length
        greater_than=0
    [/variable]
[do]
    {RANDOM Gs,Hh^Uf,Cud,Gs^Uf,Gs,Hh,Ds^Edt,Ds^Edt,Hh^Fmf,Gs,Gs^Fmf}
    [terrain]
        terrain=$random
        x,y=$terrain_to_change.x,$terrain_to_change.y
    [/terrain]
    {WCT_STORE_POSSIBLE_DIRTY_DELTA}
[/do]
[/while]
#enddef

#define WCT_STORE_UNCONECTED_FACTORY_RAIL_A
[store_locations]
    terrain=*^Br|
    [filter_adjacent_location]
        terrain=*^Br|,*^Br/
        count=1-2
        adjacent=nw,se
    [/filter_adjacent_location]
    [filter_adjacent_location]
        terrain=*^Br\,*^Br/,*^Vhh
        count=0
        adjacent=n,s
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
#enddef

#define WCT_STORE_UNCONECTED_FACTORY_RAIL_B
[store_locations]
    terrain=*^Br|
    [filter_adjacent_location]
        terrain=*^Br|,*^Br\
        count=1-2
        adjacent=ne,sw
    [/filter_adjacent_location]
    [filter_adjacent_location]
        terrain=*^Br\,*^Br/,*^Vhh
        count=0
        adjacent=n,s
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
#enddef

#define WCT_CONECT_FACTORY_RAILS
{WCT_STORE_UNCONECTED_FACTORY_RAIL_A}
[while]
    [variable]
        name=terrain_to_change.length
        greater_than=0
    [/variable]
[do]
    [terrain]
        terrain=*^Br\
        layer=overlay
        x,y=$terrain_to_change.x,$terrain_to_change.y
    [/terrain]
    {WCT_STORE_UNCONECTED_FACTORY_RAIL_A}
[/do]
[/while]
{WCT_STORE_UNCONECTED_FACTORY_RAIL_B}
[while]
    [variable]
        name=terrain_to_change.length
        greater_than=0
    [/variable]
[do]
    [terrain]
        terrain=*^Br/
        layer=overlay
        x,y=$terrain_to_change.x,$terrain_to_change.y
    [/terrain]
    {WCT_STORE_UNCONECTED_FACTORY_RAIL_B}
[/do]
[/while]
[store_locations]
    terrain=*^Br|
    [filter_adjacent_location]
        terrain=*^Br*,K*,*^Vhh
        count=0
        adjacent=n,s
    [/filter_adjacent_location]
    [filter_adjacent_location]
        terrain=*^Br*
        count=0-1
        adjacent=ne,sw
    [/filter_adjacent_location]
    [filter_adjacent_location]
        terrain=*^Br*
        count=0-1
        adjacent=nw,se
    [/filter_adjacent_location]
    variable=terrain_to_change
[/store_locations]
{WCT_FRACTION_LAYER_REPLACE 1 *^Br|,*^Br\,*^Br\,*^Br\,*^Br/,*^Br/,*^Br/ overlay}
#enddef