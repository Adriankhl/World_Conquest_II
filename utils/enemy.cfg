#define WORLD_CONQUEST_TEK_ENEMY_EVENTS
{WORLD_CONQUEST_TEK_ENEMY_LEADER}
{WORLD_CONQUEST_TEK_ENEMY_COMMANDERS}
{WORLD_CONQUEST_TEK_ENEMY_RECALLS}
{WORLD_CONQUEST_TEK_ENEMY_ITEM}
{WORLD_CONQUEST_TEK_ENEMY_TRAINING}
{WORLD_CONQUEST_TEK_ENEMY_CASTLE_EXPANSION}
{WORLD_CONQUEST_TEK_ENEMY_THEMED_EVENT}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_ARMY_EVENT
[fire_event]
    name=wct_enemy_army
[/fire_event]
#enddef

#define DR_ENEMY_EVENT WML
[event]
    name=wct_enemy_army
    {WML}
[/event]
#enddef

#define WORLD_CONQUEST_TEK_3P_ENEMY_ARMY_DEFINITIONS
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_2}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_3}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_4}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_6}}
#enddef

#define WORLD_CONQUEST_TEK_2P_ENEMY_ARMY_DEFINITIONS
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_2}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_3}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_4}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_6}}
#enddef

#define WORLD_CONQUEST_TEK_1P_ENEMY_ARMY_DEFINITIONS
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_2}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_3}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_4}}
{DR_ENEMY_EVENT {WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_6}}
#enddef

######################################################
###### enemy army for 3 players ##
#define WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_1
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 150}
{WCT_ENEMY 4 1 no no 3 0}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_2
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 135}
{WCT_ENEMY 4 0 no no 3 0}
{WCT_ENEMY 5 0 yes no 3 0}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_3
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 140}
{WCT_ENEMY 4 0 no no 6 1}
{WCT_ENEMY 5 0 no yes 6 1}
{WCT_ENEMY 6 1 yes no "$($difficulty.enemy_power-4)" 3}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_4
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 150}
{WCT_ENEMY 4 1 no yes $difficulty.enemy_power 3}
{WCT_ENEMY 5 0 yes no $difficulty.enemy_power 3}
{WCT_ENEMY 6 1 yes no $difficulty.enemy_power 3}
{WCT_ENEMY 7 0 no yes $difficulty.enemy_power 3}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_3P_SCENARIO_6
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 175}
{WCT_ENEMY 4 1 yes yes "$(3+$difficulty.enemy_power*2)" "$(1+$difficulty.enemy_power)"}

{WCT_ENEMY 5 1 yes no "$(3+$difficulty.enemy_power*2)" "$(2+$difficulty.enemy_power)"}

{WCT_ENEMY 6 1 yes yes "$(3+$difficulty.enemy_power*2)" "$(1+$difficulty.enemy_power)"}

{WCT_ENEMY 7 1 yes no "$(3+$difficulty.enemy_power*2)" "$(1+$difficulty.enemy_power)"}

{WCT_ENEMY 8 1 no yes "$(3+$difficulty.enemy_power*2)" "$(2+$difficulty.enemy_power)"}

{WCT_ENEMY 9 1 yes yes "$(3+$difficulty.enemy_power*2)" "$(1+$difficulty.enemy_power)"}
#enddef

###### enemy army  for 2 players ##
#define WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_1
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 150}
{WCT_ENEMY_DELAYED 3 4 1 no no 2 0}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_2
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 135}
{WCT_ENEMY 4 0 no no 2 0}
{WCT_ENEMY_DELAYED 3 5 0 yes no 2 0}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_3
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 140}
{WCT_ENEMY 4 0 no no 4 1}
{WCT_ENEMY 5 0 no yes 4 1}
{WCT_ENEMY_DELAYED 3 6 1 yes no "$($difficulty.enemy_power-5)" 2}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_4
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 150}
{WCT_ENEMY 4 1 no yes "$($difficulty.enemy_power-2)" 2}
{WCT_ENEMY 5 0 yes no "$($difficulty.enemy_power-2)" 2}
{WCT_ENEMY 6 1 yes no "$($difficulty.enemy_power-2)" 2}
{WCT_ENEMY_DELAYED 3 7 0 no yes "$($difficulty.enemy_power-2)" 2}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_2P_SCENARIO_6
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 175}
{WCT_ENEMY 4 1 yes yes "$($difficulty.enemy_power*2-1)" "$($difficulty.enemy_power-1)"}

{WCT_ENEMY 5 1 yes no "$($difficulty.enemy_power*2-1)" "$($difficulty.enemy_power)"}

{WCT_ENEMY 6 1 yes yes "$($difficulty.enemy_power*2-1)" "$($difficulty.enemy_power-1)"}

{WCT_ENEMY 7 1 yes no "$($difficulty.enemy_power*2-1)" "$($difficulty.enemy_power-1)"}

{WCT_ENEMY 8 1 no yes "$($difficulty.enemy_power*2-1)" "$($difficulty.enemy_power)"}

{WCT_ENEMY_DELAYED 3 9 1 yes yes "$($difficulty.enemy_power*2-1)" "$($difficulty.enemy_power-1)"}
#enddef

###### enemy army  for 1 player ##
#define WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_1
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 150}
{WCT_ENEMY_DELAYED 2 4 1 no no 1 0}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_2
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 135}
{WCT_ENEMY_DELAYED 2 4 0 no no 1 0}
{WCT_ENEMY_DELAYED 3 5 0 yes no 1 0}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_3
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 140}
{WCT_ENEMY 4 0 no no 2 1}
{WCT_ENEMY_DELAYED 2 5 0 no yes 2 1}
{WCT_ENEMY_DELAYED 3 6 1 yes no "$($difficulty.enemy_power-6)" 1}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_4
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 150}
{WCT_ENEMY 4 1 no yes "$($difficulty.enemy_power-4)" 1}
{WCT_ENEMY 5 0 yes no "$($difficulty.enemy_power-4)" 1}
{WCT_ENEMY_DELAYED 2 6 1 yes no "$($difficulty.enemy_power-4)" 1}

{WCT_ENEMY_DELAYED 3 7 0 no yes "$($difficulty.enemy_power-4)" 1}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_1P_SCENARIO_6
{WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD 175}
{WCT_ENEMY 4 1 yes yes "$($difficulty.enemy_power*2-5)" "$($difficulty.enemy_power-3)"}

{WCT_ENEMY 5 1 yes no "$($difficulty.enemy_power*2-5)" "$($difficulty.enemy_power-2)"}

{WCT_ENEMY 6 1 yes yes "$($difficulty.enemy_power*2-5)" "$($difficulty.enemy_power-3)"}

{WCT_ENEMY 7 1 yes no "$($difficulty.enemy_power*2-5)" "$($difficulty.enemy_power-3)"}

{WCT_ENEMY_DELAYED 2 8 1 no yes "$($difficulty.enemy_power*2-5)" "$($difficulty.enemy_power-2)"}

{WCT_ENEMY_DELAYED 3 9 1 yes yes "$($difficulty.enemy_power*2-5)" "$($difficulty.enemy_power-3)"}
#enddef
###### end of enemy army configuration ##
######################################################

#define WORLD_CONQUEST_TEK_ENEMY_BONUS_GOLD GOLD
## adjust enemy gold for difficulty level
## enemy sides get 50% extra gold per player
{VARIABLE enemy_army.bonus_gold "$($players*$difficulty.enemy_power*{GOLD}/6+$difficulty.enemy_power*{GOLD}/6-{GOLD}*2)"}
#enddef

#define WCT_ENEMY SIDE ALLIES ITEM TRAIN LEVEL2 LEVEL3
[store_unit]
    variable=unit
    [filter]
        side={SIDE}
    [/filter]
[/store_unit]
{WORLD_CONQUEST_TEK_ENEMY_ARMY {SIDE} {ALLIES} {ITEM} {TRAIN} {LEVEL2} {LEVEL3}}
#enddef

#define WCT_ENEMY_DELAYED EMPTY_SIDE SIDE ALLIES ITEM TRAIN LEVEL2 LEVEL3
[store_unit]
    variable=unit
    [filter]
        side={EMPTY_SIDE}
    [/filter]
[/store_unit]
{WORLD_CONQUEST_TEK_ENEMY_ARMY {SIDE} {ALLIES} {ITEM} {TRAIN} {LEVEL2} {LEVEL3}}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_ARMY SIDE ALLIES ITEM TRAIN LEVEL2 LEVEL3
{CLEAR_VARIABLE enemy[{SIDE}].training}
{VARIABLE enemy[{SIDE}].commanders {ALLIES}}
{VARIABLE enemy[{SIDE}].have_item {ITEM}}
{VARIABLE enemy[{SIDE}].trained {TRAIN}}
{VARIABLE enemy[{SIDE}].recall.level2 {LEVEL2}}
{VARIABLE enemy[{SIDE}].recall.level3 {LEVEL3}}
{VARIABLE leader_side {SIDE}}
[fire_event]
    name=wct_enemy_leader
    [primary_unit]
        x,y=$unit.x,$unit.y
    [/primary_unit]
[/fire_event]
[fire_event]
    name=wct_enemy_castle_expansion
    [primary_unit]
        x,y=$unit.x,$unit.y
    [/primary_unit]
[/fire_event]
[fire_event]
    name=wct_enemy_commanders
    [primary_unit]
        x,y=$unit.x,$unit.y
    [/primary_unit]
[/fire_event]
{CLEAR_VARIABLE unit}
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_LEADER
[event]
    name=wct_enemy_leader
    first_time_only=no
    ## get rid of old leader, replace it with a new leader of the appropriate group
    [kill]
        x,y=$unit.x,$unit.y
    [/kill]
    {VARIABLE_OP temp_type rand 0.."$($enemy_army.leader.length|-1)"}
    {VARIABLE enemy[$leader_side].type $enemy_army.leader[$temp_type].type}
    {CLEAR_VARIABLE enemy_army.leader[$temp_type]}
    {CLEAR_VARIABLE temp_type}
    {VARIABLE_OP leader rand 0.."$($enemy_army.group[$enemy[$leader_side].type|].leader.length|-1)"}
    [if]
        [variable]
            name=scenario
            equals=1
        [/variable]
    [then]
        {VARIABLE type type}
    [/then]
    [else]
        {VARIABLE type advanced}
    [/else]
    [/if]
    [unit]
        x,y=$unit.x,$unit.y
        type=$enemy_army.group[$enemy[$leader_side].type].leader[$leader].$type|
        side=$leader_side
        canrecruit=yes
        generate_name=yes
        max_moves=0
    [/unit]
    {CLEAR_VARIABLE type}
    ## rename undead
    [store_unit]
        variable=temp_unit
        [filter]
            x,y=$unit.x,$unit.y
        [/filter]
    [/store_unit]
    [if]
        {VARIABLE_CONDITIONAL temp_unit.name equals ""}
    [then]
        {WCT_RANDOM_NAME temp_unit.name}
        [unstore_unit]
            variable=temp_unit
        [/unstore_unit]
    [/then]
    [/if]
    {CLEAR_VARIABLE temp_unit}
    ## set recruits; enemy leader gets faction recruits, plus leader list
    [set_recruit]
        side=$leader_side
        recruit=$enemy_army.group[$enemy[$leader_side].type].recruit
    [/set_recruit]
    [allow_recruit]
        side=$leader_side
        type=$enemy_army.group[$enemy[$leader_side].type].leader[$leader].recruit
    [/allow_recruit]
    {CLEAR_VARIABLE enemy_army.group[$enemy[$leader_side].type].leader[$leader]}
    {CLEAR_VARIABLE leader}
    ## give bonus gold
    [gold]
        side=$leader_side
        amount=$enemy_army.bonus_gold
    [/gold]
    {CLEAR_VARIABLE leader_side}
[/event]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_COMMANDERS
[event]
    name=wct_enemy_commanders
    first_time_only=no
    ## pick random allied group
    ## allies are not from leader faction
    {VARIABLE I 0}
    {FOREACH enemy_army.group group_i}
        [if]
            [variable]
                name=group_i
                not_equals=$enemy[$unit.side].type
            [/variable]
        [then]
            {VARIABLE enemy[$unit.side].random_allies[$I].type $group_i}
            {VARIABLE_OP I add 1}
        [/then]
        [/if]
    {NEXT group_i}
    {CLEAR_VARIABLE I}
    {REPEAT_IT $enemy[$unit.side].commanders ally_i}
        {VARIABLE_OP temp_type rand 0.."$($enemy[$unit.side].random_allies.length-1)"}
        {VARIABLE ally $enemy[$unit.side].random_allies[$temp_type].type}
        {CLEAR_VARIABLE enemy[$unit.side].random_allies[$temp_type]}
        {VARIABLE_OP temp_type rand 0.."$($enemy_army.group[$ally].leader.length-1)"}
        ## allies give leader extra recruits
        [allow_recruit]
            side=$unit.side
            type=$enemy_army.group[$ally].leader[$temp_type].recruit
        [/allow_recruit]
        {CLEAR_VARIABLE temp_type}
        ## create helper unit (commander), level2 after map4
        {VARIABLE_OP ally_type rand $enemy_army.group[$ally].helper}
        [if]
            [variable]
                name=scenario
                greater_than=4
            [/variable]
        [then]
            {VARIABLE_OP ally_type rand $enemy_army.group[$ally].advanced_helper}
        [/then]
        [/if]
        [unit]
            x,y=$unit.x,$unit.y
            type=$ally_type
            side=$unit.side
            generate_name=yes
            role=commander
            overlays=misc/leader-expendable.png
            experience="$($scenario*($difficulty.enemy_power-6))"
            [modifications]
                {WORLD_CONQUEST_II_TRAIT_HEROIC}
            [/modifications]
        [/unit]
    {NEXT ally_i}
    {CLEAR_VARIABLE ally,ally_type}
    {CLEAR_VARIABLE enemy[$unit.side].random_allies}
[/event]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_RECALLS
## as recall event was buggy, they are fake recalls
## this was done due a bug in 1.10.6 crashing wesnoth when training recalls. It was solved in 1.11 ...but has no sense change again code as it allows more control over AI behavior
[event]
    name=recruit
    first_time_only=no
    [filter_condition]
        [variable]
            name=enemy[$unit.side].recall.level2
            greater_than=0
        [/variable]
    [/filter_condition]
    ## find out where can be placed fake recalls
    [store_locations]
        variable=candidates
            terrain=K*,C*,*^C*,*^K*
            [and]
                [filter]
                    canrecruit=yes
                    side=$unit.side
                    [filter_location]
                        terrain=K*^*,*^K*
                    [/filter_location]
                [/filter]
                radius=999
                [filter_radius]
                    terrain=K*^*,C*^*,*^K*,*^C*
                [/filter_radius]
            [/and]
            [not]
                [filter]
                [/filter]
            [/not]
    [/store_locations]
    {SHUFFLE_ARRAY candidates}
    {WCT_ENEMY_RECALLS_LEVEL 3}
    {WCT_ENEMY_RECALLS_LEVEL 2}
    {CLEAR_VARIABLE temp_type,candidates}
[/event]
#enddef

#define WCT_ENEMY_RECALLS_LEVEL LEVEL
[while]
    {VARIABLE_CONDITIONAL enemy[$unit.side].recall.level{LEVEL} greater_than 0}
    {VARIABLE_CONDITIONAL candidates.length greater_than 0}
[do]
    {VARIABLE_OP temp_type rand ($enemy_army.group[$enemy[$unit.side].type].recall_level{LEVEL})}
    {WCT_ENEMY_FAKE_RECALL $unit.side $temp_type}
    {VARIABLE_OP enemy[$unit.side].recall.level{LEVEL} add -1}
[/do]
[/while]
#enddef

#define WCT_ENEMY_FAKE_RECALL SIDE TYPE
[unit]
    side={SIDE}
    type={TYPE}
    generate_name=yes
    x,y=$candidates[0].x,$candidates[0].y
    moves=0
[/unit]
[if]
    {VARIABLE_CONDITIONAL enemy[{SIDE}].trained equals yes}
[then]
    [store_unit]
        variable=unit
        [filter]
            x,y=$candidates[0].x,$candidates[0].y
        [/filter]
    [/store_unit]
    {WORLD_CONQUEST_TEK_TRAIN enemy[{SIDE}]}
[/then]
[/if]
{CLEAR_VARIABLE candidates[0]}
[gold]
    side={SIDE}
    amount=-20
[/gold]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_CASTLE_EXPANSION
## AI sides get more recruiting hexes: look for appropriate spots within 2 hexes, contiguous with existing castle (AI sides get 1 extra hex per player)
[event]
    name=wct_enemy_castle_expansion
    first_time_only=no
    [store_locations]
        variable=candidates
        [not]
            terrain=C*,K*,X*,*^Xm,Ww,Wwt,Wwg,Wo*,Wwr*,*^V*
        [/not]
        [not]
            terrain=Mv
            radius=1
        [/not]
        [filter_adjacent_location]
            terrain=C*,K*
            [and]
                [filter]
                    side=$unit.side
                [/filter]	
                radius=1
            [/and]
        [/filter_adjacent_location]
    [/store_locations]
    ## allow any terrain if there is no room
    [if]
        [variable]
            name=candidates.length
            less_than="$($players+1)"
        [/variable]
    [then]
        [store_locations]
            variable=candidates
            [not]
                terrain=C*,K*
            [/not]
            [not]
                terrain=Mv
                radius=1
            [/not]
            [filter_adjacent_location]
                terrain=C*,K*
                [and]
                    [filter]
                        side=$unit.side
                    [/filter]	
                    radius=1
                [/and]
            [/filter_adjacent_location]
        [/store_locations]
    [/then]
    [/if]
    {SHUFFLE_ARRAY candidates}
    {REPEAT_IT "$($players+1)" castle_i}
        [terrain]
            x=$candidates[$castle_i].x
            y=$candidates[$castle_i].y
            terrain=Ch
        [/terrain]
    {NEXT castle_i}
    {CLEAR_VARIABLE candidates}
[/event]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_TRAINING
[event]
    name=side turn 1
    first_time_only=no
    [filter_condition]
        [variable]
            name=enemy[$side_number].trained
            equals=yes
        [/variable]
    [/filter_condition]
    ## enemies can only get Melee, Ranger, Health or Movement
    {REPEAT_IT 4 train_i}
        {VARIABLE enemy[$side_number].training[$train_i].level 0}
    {NEXT train_i}
    {RANDOM 0..3}
    {VARIABLE_OP enemy[$side_number].training[$random].level add 1}
[/event]
[event]
    name=recruit
    first_time_only=no
    [filter_condition]
        [variable]
            name=enemy[$unit.side].trained
            equals=yes
        [/variable]
    [/filter_condition]
    {WORLD_CONQUEST_TEK_TRAIN enemy[$unit.side]}
[/event]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_ITEM
[event]
    name=turn 2
    ## using prerecruit to allow artifact events written into unit become active in recruit
    [event]
        name=prerecruit
        first_time_only=no
        [filter_condition]
            [variable]
                name=enemy[$unit.side].have_item
                equals=yes
            [/variable]
        [/filter_condition]
        {VARIABLE_OP T rand 0.."$($enemy_army.artifact.length-1)"}
        {WORLD_CONQUEST_TEK_ARTIFACT_EFFECTS wct.artifact[$enemy_army.artifact[$T].type]}
        {VARIABLE enemy[$unit.side].item.unit_id $unit.id}
        {VARIABLE enemy[$unit.side].item.type $enemy_army.artifact[$T].type}
    [/event]
    ## extra buffs
    [event]
        name=recruit
        first_time_only=no
        [filter_condition]
            [variable]
                name=enemy[$unit.side].have_item
                equals=yes
            [/variable]
        [/filter_condition]
        ## experience unit with item so lvls
        {REPEAT_IT $scenario buff_i}
            [store_unit]
                variable=unit
                [filter]
                    x,y=$unit.x,$unit.y
                [/filter]
            [/store_unit]
            {VARIABLE_OP unit.experience add "$(16+$difficulty.enemy_power)"}
            [unstore_unit]
                variable=unit
                fire_event=yes
            [/unstore_unit]
        {NEXT buff_i}
        ## add hp if feeding
        [if]
            [variable]
                name=wct.artifact[$enemy_army.artifact[$T].type].name
                equals=_"Ghoul's blood"
            [/variable]
        [then]
            [object]
                silent=yes
                duration=forever
                [filter]
                    x,y=$unit.x,$unit.y
                [/filter]
                [effect]
                    apply_to=hitpoints
                    increase="$($scenario*3)"
                    increase_total="$($scenario*3)"
                [/effect]
            [/object]
        [/then]
        [/if]
        {CLEAR_VARIABLE enemy_army.artifact[$T]}
        {VARIABLE enemy[$unit.side].have_item equiped}	
        {CLEAR_VARIABLE T}
    [/event]
    ## drop item on death
    [event]
        name=die
        first_time_only=no
        [filter]
            id=$enemy[$unit.side].item.unit_id
        [/filter]
        {VARIABLE items.point[$unit.side].x $unit.x}
        {VARIABLE items.point[$unit.side].y $unit.y}
        {VARIABLE items.point[$unit.side].type $enemy[$unit.side].item.type}
        {VARIABLE temp_message.speaker narrator}
        {VARIABLE temp_message.caption $wct.artifact[$items.point[$unit.side].type].name}
        {VARIABLE temp_message.message $wct.artifact[$items.point[$unit.side].type].info+"
"+{STR_COLOR_BONUS $wct.artifact[$items.point[$unit.side].type].description}}
        {VARIABLE temp_message.image $wct.artifact[$items.point[$unit.side].type].icon}
        [insert_tag]
            name=message
            variable=temp_message
        [/insert_tag]
        {CLEAR_VARIABLE temp_message} 
        [item]
            x,y=$items.point[$unit.side].x,$items.point[$unit.side].y
            image=$wct.artifact[$items.point[$unit.side].type].icon
        [/item]
        {CLEAR_VARIABLE enemy[$unit.side].item}
    [/event]
[/event]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_RANDOM_LEADER_DEFINITIONS
{FOREACH enemy_army.group group_i}
    {REPEAT_IT 4 copy_i}
        [set_variables]
            mode=append
            name=enemy_army.leader
            [value]
                type=$group_i
            [/value]
        [/set_variables]
    {NEXT copy_i}
{NEXT group_i}
#enddef

#define WCT_ENEMY_THEMED RACE PET CASTLE VILLAGE CHANCE
[set_variables]
    name=enemy_themed
    [value]
        race={RACE}
        pet={PET}
        castle={CASTLE}
        village={VILLAGE}
        chance={CHANCE}
    [/value]
[/set_variables]
[fire_event]
    name=wct_enemy_themed
[/fire_event]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_THEMED_EVENT
[event]
    name=wct_enemy_themed
    first_time_only=no
    {RANDOM 0..99}
    [store_unit]
        [filter]
            side=4,5,6,7,8,9
            canrecruit=yes
            race=$enemy_themed.race
        [/filter]
        variable=enemy_themed.boss
    [/store_unit]
    [if]
        {VARIABLE_CONDITIONAL random less_than $enemy_themed.chance}
        {VARIABLE_CONDITIONAL enemy_themed.boss.length greater_than 0}
    [then]
        ## give themed castle
        [terrain]
            x=$enemy_themed.boss.x
            y=$enemy_themed.boss.y
            terrain=K$enemy_themed.castle
        [/terrain]
        [terrain]
            terrain=C$enemy_themed.castle
            [and]
                terrain=C*,*^C*
                [and]
                    [filter]
                        x=$enemy_themed.boss.x
                        y=$enemy_themed.boss.y
                    [/filter]
                    radius=999
                    [filter_radius]
                        terrain=K*^*,C*^*,*^K*,*^C*
                    [/filter_radius]
                [/and]
            [/and]
        [/terrain]
        ## extra tweak with trees to elvish castle
        [store_locations]
            terrain=Cv
            [filter_adjacent_location]
                terrain=Kv
            [/filter_adjacent_location]
            variable=terrain_to_change
        [/store_locations]
        {RANDOM 2..3}
        {WCT_FRACTION_REPLACE $random Cv^Fet}
        ## adjacent themed villages
        [terrain]
             terrain=$enemy_themed.village
            [and]
                terrain=*^V*
                [filter_adjacent_location]
                    terrain=C$enemy_themed.castle,K$enemy_themed.castle
                [/filter_adjacent_location]
            [/and]
        [/terrain]
        ## give pet
        [unit]
            x,y=$enemy_themed.boss.x,$enemy_themed.boss.y
            type=$enemy_themed.pet
            side=$enemy_themed.boss.side
            name= {STR_ENEMY_PET}
            role=hero
            overlays=misc/hero-icon.png
            [modifications]
                {WORLD_CONQUEST_II_TRAIT_HEROIC}
            [/modifications]
        [/unit]
    [/then]
    [/if]
    {CLEAR_VARIABLE enemy_themed}
[/event]
#enddef

#define WORLD_CONQUEST_TEK_ENEMY_GROUP_DEFINITIONS
[group]
    id=northerners
    helper=Orcish Leader,Orcish Grunt,Orcish Archer,Orcish Assassin
    advanced_helper=Orcish Ruler,Orcish Slayer,Orcish Crossbowman,Troll Rocklobber,Troll,Orcish Warrior
    recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin,Troll Whelp
    recall_level2=Orcish Ruler,Orcish Slayer,Orcish Crossbowman,Troll Rocklobber,Troll,Orcish Warrior,Goblin Pillager,Goblin Knight,Orcish Crossbowman,Troll,Orcish Warrior
    recall_level3=Orcish Warlord,Troll Warrior,Orcish Slurbow,Orcish Sovereign,Direwolf Rider,Orcish Warlord,Troll Warrior,Orcish Slurbow 
    [leader]
        type=Orcish Warrior
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin
        advanced=Orcish Warlord
    [/leader]
    [leader]
        type=Troll
        recruit=Orcish Grunt,Orcish Archer,Orcish Assassin,Troll Whelp
        advanced=Troll Warrior
    [/leader]
    [leader]
        type=Troll Rocklobber
        recruit=Orcish Grunt,Orcish Assassin,Wolf Rider,Troll Whelp
        advanced=Orcish Warlord
    [/leader]
    [leader]
        type=Orcish Crossbowman
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin
        advanced=Orcish Slurbow
    [/leader]
    [leader]
        type=Orcish Slayer
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin,Naga Fighter
        advanced=Naga Myrmidon
    [/leader]
    [leader]
        type=Goblin Knight
        recruit=Goblin Spearman,Orcish Leader,Wolf Rider,Orcish Archer,Troll Whelp
        advanced=Direwolf Rider
    [/leader]
    [leader]
        type=Orcish Ruler
        recruit=Orcish Grunt,Orcish Leader,Wolf Rider,Orcish Archer
        advanced=Orcish Sovereign
    [/leader]
[/group]
[group]
    id=loyalists
    helper=Sergeant,Spearman,Bowman,Mage,Fencer,Heavy Infantryman
    advanced_helper=White Mage,Red Mage,Duelist,Longbowman,Shock Trooper,Pikeman,Swordsman,Lieutenant,Javelineer
    recruit=Spearman,Bowman,Cavalryman,Fencer,Mage
    recall_level2=White Mage,Red Mage,Duelist,Longbowman,Shock Trooper,Pikeman,Swordsman,Lieutenant,Dragoon,Knight,Javelineer,Pikeman,Swordsman,Longbowman
    recall_level3=General,Halberdier,Silver Mage,Iron Mauler,Master Bowman,Master at Arms,Arch Mage,Mage of Light,Paladin,Grand Knight,Cavalier,General,Halberdier,Iron Mauler,Master Bowman,Master at Arms 
    [leader]
        type=Lieutenant
        recruit=Spearman,Bowman,Cavalryman,Fencer,Mage
        advanced=General
    [/leader]
    [leader]
        type=Swordsman
        recruit=Spearman,Bowman,Cavalryman,Heavy Infantryman,Mage
        advanced=Royal Guard
    [/leader]
    [leader]
        type=Pikeman
        recruit=Spearman,Bowman,Cavalryman,Horseman,Mage
        advanced=Halberdier
    [/leader]
    [leader]
        type=Javelineer
        recruit=Spearman,Bowman,Horseman,Fencer,Mage
        advanced=Silver Mage
    [/leader]
    [leader]
        type=Shock Trooper
        recruit=Spearman,Mage,Cavalryman,Heavy Infantryman
        advanced=Iron Mauler
    [/leader]
    [leader]
        type=Longbowman
        recruit=Spearman,Bowman,Cavalryman,Horseman,Heavy Infantryman
        advanced=Master Bowman
    [/leader]
    [leader]
        type=Duelist
        recruit=Spearman,Bowman,Cavalryman,Fencer,Mage
        advanced=Master at Arms
    [/leader]
    [leader]
        type=Red Mage
        recruit=Spearman,Bowman,Mage,Cavalryman,Heavy Infantryman
        advanced=Arch Mage
    [/leader]
    [leader]
        type=White Mage
        recruit=Spearman,Heavy Infantryman,Cavalryman,Mage,Bowman
        advanced=Mage of Light
    [/leader]
[/group]
[group]
    id=elves
    helper=Elvish Shaman,Elvish Fighter,Elvish Archer,Wose
    advanced_helper=Elder Wose,Elvish Sorceress,Elvish Druid,Elvish Marksman,Elvish Ranger,Elvish Hero,Elvish Captain,Elvish Lord
    recruit=Elvish Fighter,Elvish Archer,Elvish Shaman,Elvish Scout,Wose
    recall_level2=Elder Wose,Elvish Sorceress,Elvish Druid,Elvish Marksman,Elvish Ranger,Elvish Hero,Elvish Captain,Elvish Rider
    recall_level3=Elvish Marshal,Elvish Champion,Elvish Avenger,Elvish Sharpshooter,Elvish Shyde,Elvish Enchantress,Ancient Wose,Elvish Outrider 
    [leader]
        type=Elvish Captain
        recruit=Elvish Fighter,Elvish Archer,Elvish Shaman,Elvish Scout
        advanced=Elvish Marshal
    [/leader]
    [leader]
        type=Elvish Hero
        recruit=Elvish Fighter,Elvish Archer,Elvish Shaman,Elvish Scout
        advanced=Elvish Champion
    [/leader]
    [leader]
        type=Elvish Ranger
        recruit=Elvish Fighter,Elvish Archer,Wose,Elvish Scout
        advanced=Elvish Avenger
    [/leader]
    [leader]
        type=Elvish Marksman
        recruit=Elvish Fighter,Elvish Archer,Mage,Elvish Scout
        advanced=Elvish Sharpshooter
    [/leader]
    [leader]
        type=Elvish Druid
        recruit=Elvish Fighter,Elvish Archer,Elvish Shaman,Wose
        advanced=Elvish Shyde
    [/leader]
    [leader]
        type=Elvish Sorceress
        recruit=Elvish Fighter,Elvish Archer,Elvish Shaman,Elvish Scout,Mage
        advanced=Elvish Enchantress
    [/leader]
    [leader]
        type=Elder Wose
        recruit=Elvish Shaman,Elvish Fighter,Mage, Wose
        advanced=Ancient Wose
    [/leader]
[/group]
[group]
    id=Knalgans
    helper=Dwarvish Thunderer,Dwarvish Fighter,Dwarvish Guardsman,Dwarvish Scout
    advanced_helper=Dwarvish Stalwart,Dwarvish Thunderguard,Dwarvish Steelclad,Dwarvish Pathfinder,Rogue,Trapper
    recruit=Dwarvish Fighter,Dwarvish Thunderer,Thief,Footpad,Poacher
    recall_level2=Dwarvish Stalwart,Dwarvish Thunderguard,Dwarvish Steelclad,Rogue,Trapper,Gryphon Master,Bandit,Outlaw,Dwarvish Stalwart,Dwarvish Thunderguard,Dwarvish Steelclad,Dwarvish Berserker
    recall_level3=Dwarvish Lord,Dwarvish Dragonguard,Dwarvish Sentinel,Assassin,Huntsman,Fugitive,Highwayman,Dwarvish Lord,Dwarvish Dragonguard,Dwarvish Sentinel 
    [leader]
        type=Dwarvish Steelclad
        recruit=Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Guardsman
        advanced=Dwarvish Lord
    [/leader]
    [leader]
        type=Dwarvish Thunderguard
        recruit=Dwarvish Fighter,Dwarvish Thunderer,Gryphon Rider,Poacher
        advanced=Dwarvish Dragonguard
    [/leader]
    [leader]
        type=Dwarvish Stalwart
        recruit=Footpad,Dwarvish Thunderer,Gryphon Rider,Dwarvish Guardsman
        advanced=Dwarvish Sentinel
    [/leader]
    [leader]
        type=Rogue
        recruit=Thug,Thief,Footpad,Dwarvish Ulfserker,Gryphon Rider
        advanced=Assassin
    [/leader]
    [leader]
        type=Trapper
        recruit=Thug,Thief,Poacher,Dwarvish Fighter,Dwarvish Thunderer
        advanced=Huntsman
    [/leader]
    [leader]
        type=Bandit
        recruit=Thug,Thief,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Fighter
        advanced=Highwayman
    [/leader]
[/group]
[group]
    id=drakes
    helper=Drake Burner,Drake Fighter,Drake Clasher
    advanced_helper=Drake Arbiter,Drake Thrasher,Drake Warrior,Fire Drake,Drake Flare
    recruit=Drake Fighter,Drake Clasher,Drake Glider,Drake Burner,Saurian Augur
    recall_level2=Drake Arbiter,Drake Thrasher,Drake Warrior,Fire Drake,Drake Flare,Saurian Oracle,Saurian Soothsayer,Saurian Ambusher,Drake Warrior,Drake Thrasher,Sky Drake
    recall_level3=Drake Flameheart,Inferno Drake,Drake Blademaster,Drake Blademaster,Drake Enforcer,Drake Warden,Saurian Flanker,Saurian Flanker,Hurricane Drake
    [leader]
        type=Drake Flare
        recruit=Drake Fighter,Drake Clasher,Drake Glider,Drake Burner
        advanced=Drake Flameheart
    [/leader]
    [leader]
        type=Fire Drake
        recruit=Drake Fighter,Saurian Augur,Drake Glider,Drake Burner
        advanced=Inferno Drake
    [/leader]
    [leader]
        type=Drake Warrior
        recruit=Drake Fighter,Saurian Skirmisher,Drake Glider,Drake Burner
        advanced=Drake Blademaster
    [/leader]
    [leader]
        type=Drake Thrasher
        recruit=Drake Fighter,Drake Clasher,Saurian Skirmisher,Drake Burner
        advanced=Drake Enforcer
    [/leader]
    [leader]
        type=Drake Arbiter
        recruit=Saurian Skirmisher,Drake Clasher,Drake Glider,Drake Burner
        advanced=Drake Warden
    [/leader]
    [leader]
        type=Saurian Oracle
        recruit=Saurian Skirmisher,Saurian Augur,Drake Clasher,Drake Burner
        advanced=Saurian Flanker
    [/leader]
    [leader]
        type=Saurian Soothsayer
        recruit=Saurian Skirmisher,Saurian Augur,Drake Glider,Drake Fighter
        advanced=Hurricane Drake
    [/leader]
[/group]
[group]
    id=undead
    helper=Dark Adept,Skeleton Archer,Skeleton,Ghoul
    advanced_helper=Revenant,Deathblade,Bone Shooter,Dark Sorcerer,Necrophage
    recruit=Skeleton,Skeleton Archer,Ghost,Ghoul,Dark Adept
    recall_level2=Revenant,Deathblade,Bone Shooter,Dark Sorcerer,Necrophage,Wraith,Shadow,Revenant,Bone Shooter,Dark Sorcerer,Necrophage
    recall_level3=Draug,Death Knight,Necromancer,Lich,Ghast,Banebow,Spectre,Nightgaunt,Draug,Ghast,Banebow
    [leader]
        type=Revenant
        recruit=Skeleton,Skeleton Archer,Ghost,Ghoul
        advanced=Draug
    [/leader]
    [leader]
        type=Deathblade
        recruit=Skeleton,Skeleton Archer,Dark Adept,Ghoul
        advanced=Death Knight
    [/leader]
    [leader]
        type=Bone Shooter
        recruit=Skeleton,Skeleton Archer,Ghost,Ghoul
        advanced=Banebow
    [/leader]
    [leader]
        type=Dark Sorcerer
        recruit=Skeleton Archer,Dark Adept,Ghoul,Vampire Bat
        advanced=Lich
    [/leader]
    [leader]
        type=Necrophage
        recruit=Skeleton,Dark Adept,Ghoul,Ghost
        advanced=Ghast
    [/leader]
[/group]
#enddef
